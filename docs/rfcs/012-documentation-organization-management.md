---
doc_id: 'RFC-2025-00012'
title: 'Documentation Organization Management'
doc_type: 'rfc'
status: 'draft'
canonical: true
created: '2025-11-13'
tags: ['documentation', 'infrastructure', 'validation', 'registry', 'agent-tools']
summary: 'Structured documentation management system with validation, registry generation, and inbox workflow to enable autonomous agents to discover, create, and maintain high-quality documentation'
supersedes: []
related: ['RFC-2025-00004']
---

# RFC-012: Documentation Organization Management

## Status

**Status**: Draft
**Created**: 2025-11-13
**Author**: Development Team

## Summary

Implement a structured documentation management system with validation, registry generation, and inbox workflow to enable autonomous agents to discover, create, and maintain high-quality documentation without creating duplicates or inconsistencies.

## Motivation

The current documentation structure lacks:

1. **Discovery Mechanism**: No machine-readable index for agents to query existing docs
2. **Duplicate Prevention**: No detection of near-duplicate or redundant documentation
3. **Lifecycle Management**: No clear status tracking (draft → active → superseded)
4. **Quality Assurance**: No validation of document structure or required metadata
5. **Draft Workflow**: No staging area for work-in-progress documentation
6. **Canonical System**: No way to mark authoritative versions of documents

### Problems This Solves

1. **Agents creating duplicate docs**: Without a registry, agents can't check if documentation already exists
2. **Scattered planning docs**: Root-level planning documents (e.g., `AGENT_INFRASTRUCTURE_ISSUES.md`) lack organization
3. **No front-matter**: Documentation lacks structured metadata for searching and categorization
4. **Manual validation**: No automated checks for documentation quality
5. **Unclear document status**: Can't distinguish between drafts, active docs, and superseded content

### Goals

1. **Machine-Readable Registry**: Generate `docs/index/registry.json` for agent consumption
2. **Inbox Workflow**: Provide `docs/_inbox/` staging area for drafts
3. **Front-Matter Schema**: Define required metadata fields for all documentation
4. **Validation Pipeline**: Automated validation in pre-commit hooks
5. **Duplicate Detection**: SimHash and fuzzy matching to prevent redundant docs
6. **Canonical System**: Mark one source of truth per concept
7. **Status Tracking**: Clear lifecycle states (draft, active, superseded, rejected, archived)

## Design

### Architecture Overview

`````text
Documentation Lifecycle
======================

1. Creation (Inbox)
   ┌─────────────┐
   │ Agent uses  │
   │ /task cmd   │──┐
   └─────────────┘  │
                    │
   ┌────────────────▼────────────────┐
   │   docs/_inbox/<draft>.md        │
   │   - Minimal front-matter        │
   │   - Work in progress            │
   │   - Excluded from strict checks │
   └────────────────┬────────────────┘
                    │
2. Validation       │
   ┌────────────────▼────────────────┐
   │  scripts/validate-docs.py       │
   │  - Check front-matter           │
   │  - Detect duplicates            │
   │  - Warn about similar docs      │
   └────────────────┬────────────────┘
                    │
3. Publication      │
   ┌────────────────▼────────────────┐
   │  Move to final location:        │
   │  - docs/rfcs/ (for RFCs)        │
   │  - docs/guides/ (for guides)    │
   │  - docs/architecture/ (for ADRs)│
   │  - docs/planning/ (for plans)   │
   └────────────────┬────────────────┘
                    │
4. Registration     │
   ┌────────────────▼────────────────┐
   │  docs/index/registry.json       │
   │  - Generated by validation      │
   │  - Queryable by agents          │
   │  - SHA256 + SimHash for dedupe  │
   └─────────────────────────────────┘
```text

### Directory Structure

```text
docs/
├── _inbox/                          # Staging area for drafts
│   ├── README.md                    # Inbox workflow guide
│   └── <draft-documents>.md         # Work in progress
│
├── index/                           # Generated artifacts
│   └── registry.json                # Machine-readable doc index
│
├── rfcs/                            # Request for Comments (existing)
│   ├── 001-rendering-architecture.md
│   ├── 012-documentation-organization-management.md (this RFC)
│   └── ...
│
├── guides/                          # How-to guides (new)
│   ├── setup/
│   ├── development/
│   └── deployment/
│
├── architecture/                    # Architecture Decision Records (new)
│   ├── adr-001-technology-stack.md
│   └── ...
│
├── planning/                        # Project planning docs (new)
│   ├── agent-infrastructure.md      # Moved from root
│   ├── enhancement-plan.md
│   └── ...
│
├── archive/                         # Superseded/deprecated docs
│   └── <old-documents>.md
│
├── DOCUMENTATION-SCHEMA.md          # Front-matter specification
└── README.md                        # Main documentation index

scripts/
└── validate-docs.py                 # Validation & registry generator

.agent/
├── rules/
│   └── documentation-management.md  # Agent rules for docs
└── commands/
    └── run-tests.yaml               # Existing

.claude/
└── commands/
    └── task.md                      # New /task command
```text

### Front-Matter Schema

All documentation (except `_inbox/`) must include YAML front-matter:

```yaml
---
doc_id: 'RFC-2025-00042' # Format: PREFIX-YYYY-NNNNN
title: 'Documentation Title'
doc_type: 'rfc' # spec|rfc|adr|plan|finding|guide|glossary|reference
status: 'active' # draft|active|superseded|rejected|archived
canonical: true # Is this the authoritative version?
created: '2025-11-13' # ISO date (YYYY-MM-DD)
updated: '2025-11-14' # Optional: last update date
tags: ['infrastructure', 'docs'] # List of tags
summary: 'Brief one-sentence summary of the document'
supersedes: [] # Optional: list of doc_ids this replaces
related: [] # Optional: list of related doc_ids
---
```text

#### Doc ID Prefixes

| Prefix       | Document Type                | Example                |
| ------------ | ---------------------------- | ---------------------- |
| `RFC-`       | Request for Comments         | `RFC-2025-00012`       |
| `ADR-`       | Architecture Decision Record | `ADR-2025-00001`       |
| `GUIDE-`     | How-to Guide                 | `GUIDE-2025-00001`     |
| `PLAN-`      | Planning Document            | `PLAN-2025-00001`      |
| `FIND-`      | Finding/Analysis             | `FIND-2025-00001`      |
| `SPEC-`      | Specification                | `SPEC-2025-00001`      |
| `GLOSSARY-`  | Glossary/Terminology         | `GLOSSARY-2025-00001`  |
| `REFERENCE-` | Reference Documentation      | `REFERENCE-2025-00001` |

#### Valid Values

**doc_type**: `spec`, `rfc`, `adr`, `plan`, `finding`, `guide`, `glossary`, `reference`

**status**:

- `draft`: Work in progress, not yet reviewed
- `active`: Reviewed and current
- `superseded`: Replaced by a newer document
- `rejected`: Proposal was rejected
- `archived`: No longer relevant but kept for historical reference

### Validation Script

**File**: `scripts/validate-docs.py`

Features:

1. **Front-matter validation**: Ensures all required fields present and valid
2. **Canonical uniqueness**: Only one canonical doc per concept (normalized title)
3. **Duplicate detection**: SimHash + fuzzy matching to detect near-duplicates
4. **Registry generation**: Creates `docs/index/registry.json`
5. **Pre-commit integration**: Validates on commit (with `--pre-commit` flag)

```bash
# Manual validation
python scripts/validate-docs.py

# Pre-commit mode (validation only, no registry regen)
python scripts/validate-docs.py --pre-commit
```text

Dependencies:

- `pyyaml`: YAML parsing
- `simhash`: Content similarity detection
- `rapidfuzz`: Title fuzzy matching

### Registry Format

**File**: `docs/index/registry.json`

```json
{
  "generated_at": "2025-11-13T12:34:56Z",
  "total_docs": 42,
  "by_type": {
    "rfc": 8,
    "guide": 15,
    "adr": 5,
    "plan": 10,
    "finding": 4
  },
  "by_status": {
    "draft": 5,
    "active": 30,
    "superseded": 3,
    "archived": 4
  },
  "docs": [
    {
      "path": "docs/rfcs/012-documentation-organization-management.md",
      "doc_id": "RFC-2025-00012",
      "title": "Documentation Organization Management",
      "doc_type": "rfc",
      "status": "draft",
      "canonical": true,
      "tags": ["infrastructure", "documentation"],
      "created": "2025-11-13",
      "summary": "Structured documentation management with validation and registry",
      "supersedes": [],
      "related": ["RFC-2025-00004"],
      "sha256": "abc123...",
      "simhash": "1234567890"
    }
  ]
}
```text

### Inbox Workflow

**Purpose**: Low-friction drafting without strict validation

**Location**: `docs/_inbox/`

**Rules**:

1. **Minimal front-matter**: Only `title`, `doc_type`, `status: draft` required
2. **No strict validation**: Excluded from required field checks
3. **Duplicate detection**: Script warns if similar docs exist in corpus
4. **Temporary home**: Docs should be moved to final location when complete

**Workflow**:

```bash
# 1. Agent creates draft using /task command
# → Creates docs/_inbox/my-draft.md with minimal front-matter

# 2. Work on draft
# → Edit, refine, add content

# 3. Validate and check for duplicates
python scripts/validate-docs.py
# → Shows warnings if similar docs exist

# 4. Complete front-matter
# → Add all required fields (doc_id, tags, summary, etc.)

# 5. Move to final location
mv docs/_inbox/my-draft.md docs/rfcs/008-my-feature.md

# 6. Commit (pre-commit hook validates)
git add docs/rfcs/008-my-feature.md
git commit -m "docs: add RFC-008 for my feature"
```text

### Task Command

**File**: `.claude/commands/task.md`

Purpose: Help agents create structured documentation tasks

```markdown
# /task - Create Documentation Task

Creates a structured documentation task in `docs/_inbox/` with proper front-matter template.

## Usage
```text

/task <doc-type> <title>

```text

## Examples

```text

/task rfc "Plugin System Architecture"
/task guide "Setting Up Development Environment"
/task adr "Use PostgreSQL for Primary Database"
/task plan "Q1 2025 Feature Roadmap"

````text

## What It Does

1. Creates file in `docs/_inbox/<slug>.md`
2. Generates minimal front-matter template
3. Adds standard sections based on doc_type
4. Opens file for editing

## Front-Matter Template

```yaml
---
title: "<your-title>"
doc_type: "<rfc|guide|adr|plan|finding|spec>"
status: "draft"
created: "<today>"
tags: []
summary: ""
# TODO: Add doc_id before moving out of inbox
# TODO: Set canonical: true/false
# TODO: Complete tags and summary
---
````text

````text

### Agent Rules

**File**: `.agent/rules/documentation-management.md`

```markdown
# Documentation Management Rules

## When Creating Documentation

1. **Check for existing docs first**:
   - Read `docs/index/registry.json`
   - Search for similar titles/topics
   - Ask user if unsure whether doc already exists

2. **Start in inbox**:
   - Use `/task` command to create drafts in `docs/_inbox/`
   - Add minimal front-matter (title, doc_type, status)
   - Validation is relaxed for inbox docs

3. **Run validation before finalizing**:
   ```bash
   python scripts/validate-docs.py
````text

- Check for duplicate warnings
- Ensure front-matter is valid
- Fix any reported issues

4. **Complete front-matter before moving**:
   - Generate doc_id following format: `PREFIX-YYYY-NNNNN`
   - Add all required fields (tags, summary, etc.)
   - Set `canonical: true` if authoritative version
   - Link related docs in `related` field

5. **Move to final location**:
   - `docs/rfcs/` - Request for Comments
   - `docs/guides/` - How-to guides
   - `docs/architecture/` - Architecture Decision Records
   - `docs/planning/` - Planning documents

6. **Commit with validation**:
   - Pre-commit hook runs validation automatically
   - Fix any errors before committing

## When Updating Documentation

1. **For minor updates**:
   - Edit in place
   - Update `updated` field in front-matter
   - Commit changes

2. **For major revisions**:
   - Create new version with new doc_id
   - Mark old version as `status: superseded`
   - Add `supersedes: ["OLD-DOC-ID"]` to new version
   - Move old version to `docs/archive/`

## Canonical Documents

- Only ONE canonical doc per concept
- Set `canonical: true` for authoritative version
- Other variants must have `canonical: false`
- Validation enforces canonical uniqueness

## Document Lifecycle

```text
draft → active → superseded/archived
  ↓       ↓          ↓
inbox  final loc  archive/
```text

## Pre-commit Hook

The pre-commit hook runs `python scripts/validate-docs.py --pre-commit` to:

- Validate front-matter of all docs (except inbox)
- Check canonical uniqueness
- Detect near-duplicates
- Fail commit if errors found (warnings allowed)

````text

## Core Components

### 1. Validation Script Dependencies

Add to project requirements:

```txt
# docs/requirements.txt
pyyaml>=6.0.1
simhash>=2.1.2
rapidfuzz>=3.5.2
````text

### 2. Pre-commit Hook Integration

**File**: `.pre-commit-config.yaml` (add to existing hooks)

```yaml
- repo: local
  hooks:
    - id: validate-docs
      name: Validate Documentation
      entry: python scripts/validate-docs.py --pre-commit
      language: python
      files: ^docs/.*\.md$
      exclude: ^docs/(_inbox|index)/
      pass_filenames: false
```text

### 3. Inbox README

**File**: `docs/_inbox/README.md`

````markdown
# Documentation Inbox

This directory is for **draft documentation** that is not yet ready for publication.

## Purpose

- **Low-friction drafting**: Start writing without worrying about perfect structure
- **Work in progress**: Iterate on docs before moving to final location
- **Duplicate checking**: Validation warns if similar docs exist

## Rules

1. **Minimal front-matter required**:
   ```yaml
   ---
   title: 'Your Title'
   doc_type: 'rfc|guide|adr|plan|finding|spec'
   status: 'draft'
   created: 'YYYY-MM-DD'
   ---
`````

`````text

2. **No strict validation**: Inbox docs excluded from required field checks

3. **Temporary home**: Move to final location when complete

4. **Check for duplicates**: Run `python scripts/validate-docs.py` before finalizing

## Workflow

1. Create draft: `/task <doc-type> <title>`
2. Write content
3. Validate: `python scripts/validate-docs.py`
4. Complete front-matter (doc_id, tags, summary, etc.)
5. Move to final location: `docs/rfcs/`, `docs/guides/`, etc.
6. Commit (pre-commit validates automatically)

## Final Locations

| Doc Type | Location                    |
| -------- | --------------------------- |
| RFC      | `docs/rfcs/`                |
| Guide    | `docs/guides/`              |
| ADR      | `docs/architecture/`        |
| Plan     | `docs/planning/`            |
| Finding  | `docs/planning/` or `docs/` |
| Spec     | `docs/`                     |

## See Also

- [DOCUMENTATION-SCHEMA.md](../DOCUMENTATION-SCHEMA.md) - Front-matter specification
- [RFC-012](../rfcs/012-documentation-organization-management.md) - This system's design

````text

### 4. Documentation Schema Reference

**File**: `docs/DOCUMENTATION-SCHEMA.md`

```markdown
# Documentation Front-Matter Schema

All documentation (except `_inbox/` drafts) must include YAML front-matter.

## Required Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `doc_id` | string | Unique ID (format: `PREFIX-YYYY-NNNNN`) | `RFC-2025-00012` |
| `title` | string | Document title | `"Documentation Organization"` |
| `doc_type` | enum | Type of document | `rfc` (see valid values below) |
| `status` | enum | Lifecycle status | `active` (see valid values below) |
| `canonical` | boolean | Is this authoritative version? | `true` |
| `created` | date | Creation date (ISO format) | `2025-11-13` |
| `tags` | array | Topic tags | `["infrastructure", "docs"]` |
| `summary` | string | One-sentence summary | `"Structured doc management"` |

## Optional Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `updated` | date | Last update date | `2025-11-14` |
| `author` | string | Primary author | `"Development Team"` |
| `supersedes` | array | List of doc_ids this replaces | `["RFC-2025-00001"]` |
| `related` | array | List of related doc_ids | `["RFC-2025-00004"]` |

## Valid Values

### doc_type

- `spec`: Technical specification
- `rfc`: Request for Comments (design proposal)
- `adr`: Architecture Decision Record
- `plan`: Planning document or roadmap
- `finding`: Research finding or analysis
- `guide`: How-to guide or tutorial
- `glossary`: Terminology definitions
- `reference`: Reference documentation

### status

- `draft`: Work in progress, not yet reviewed
- `active`: Reviewed and currently relevant
- `superseded`: Replaced by a newer document
- `rejected`: Proposal was rejected/declined
- `archived`: No longer relevant but kept for history

### Doc ID Prefixes

| Prefix | Document Type | Example |
|--------|--------------|---------|
| `RFC-` | Request for Comments | `RFC-2025-00012` |
| `ADR-` | Architecture Decision Record | `ADR-2025-00001` |
| `GUIDE-` | How-to Guide | `GUIDE-2025-00001` |
| `PLAN-` | Planning Document | `PLAN-2025-00001` |
| `FIND-` | Finding/Analysis | `FIND-2025-00001` |
| `SPEC-` | Specification | `SPEC-2025-00001` |
| `GLOSSARY-` | Glossary/Terminology | `GLOSSARY-2025-00001` |
| `REFERENCE-` | Reference Documentation | `REFERENCE-2025-00001` |

## Example

```yaml
---
doc_id: "RFC-2025-00012"
title: "Documentation Organization Management"
doc_type: "rfc"
status: "draft"
canonical: true
created: "2025-11-13"
updated: "2025-11-14"
author: "Development Team"
tags: ["infrastructure", "documentation", "agent-tools"]
summary: "Structured documentation management system with validation, registry, and inbox workflow"
supersedes: []
related: ["RFC-2025-00004"]
---
````text

## Validation

Run validation script:

```bash
python scripts/validate-docs.py
```text

Checks:

- All required fields present
- Valid doc_type and status values
- Canonical uniqueness (only one canonical doc per concept)
- Doc ID format (`PREFIX-YYYY-NNNNN`)
- Date format (ISO 8601: `YYYY-MM-DD`)
- Near-duplicate detection

### Pre-commit Hook Usage

The pre-commit hook automatically validates documentation on commit:

```bash
git commit -m "docs: add new RFC"
# → Runs: python scripts/validate-docs.py --pre-commit
# → Fails commit if validation errors found
```text

````text

## Implementation Plan

### Phase 1: Core Infrastructure (Week 1)

**Goal**: Create directory structure, validation script, and schemas

1. **Create directory structure**:
   - `docs/_inbox/` with README
   - `docs/index/` for generated registry
   - `docs/guides/`, `docs/architecture/`, `docs/planning/`
   - `scripts/validate-docs.py`

2. **Add validation script**:
   - Front-matter parsing and validation
   - Schema enforcement
   - Canonical uniqueness checking
   - Duplicate detection (SimHash + fuzzy matching)
   - Registry generation

3. **Create documentation**:
   - `docs/DOCUMENTATION-SCHEMA.md`
   - `docs/_inbox/README.md`

4. **Add dependencies**:
   - Create `requirements.txt` for Python deps
   - Document installation

**Deliverable**: Validation script works, directory structure in place

### Phase 2: Agent Integration (Week 1)

**Goal**: Enable agents to use the system

1. **Create `/task` command**:
   - `.claude/commands/task.md`
   - Template generation for different doc types
   - Automatic slug generation

2. **Add agent rules**:
   - `.agent/rules/documentation-management.md`
   - When to create docs
   - Inbox workflow
   - Validation requirements

3. **Update pre-commit config**:
   - Add doc validation hook
   - Test with sample documents

**Deliverable**: Agents can create and validate docs

### Phase 3: Migration (Week 2)

**Goal**: Migrate existing docs to new structure

1. **Reorganize root-level docs**:
   - Move planning docs to `docs/planning/`
   - Update references in other files

2. **Add front-matter to existing docs** (gradual):
   - Start with RFCs (already well-structured)
   - Generate doc_ids for existing docs
   - Add tags and summaries

3. **Generate initial registry**:
   - Run validation script
   - Verify registry.json is accurate

**Deliverable**: Existing docs have front-matter, registry generated

### Phase 4: Testing & Documentation (Week 2)

**Goal**: Ensure system works end-to-end

1. **Test workflows**:
   - Agent creates doc with `/task`
   - Validation catches errors
   - Duplicate detection works
   - Pre-commit hook runs correctly

2. **Documentation**:
   - Update `CLAUDE.md` with references to new system
   - Add examples to README
   - Document common workflows

3. **CI Integration** (optional):
   - Run validation in GitHub Actions
   - Fail PR if docs invalid

**Deliverable**: System tested and documented

## Testing Strategy

### Validation Script Tests

```python
# Test front-matter validation
def test_missing_required_fields():
    """Ensure missing required fields are detected"""
    doc = create_test_doc(missing=['doc_id', 'tags'])
    errors = validate_frontmatter(doc)
    assert len(errors) == 2
    assert 'doc_id' in str(errors[0])
    assert 'tags' in str(errors[1])

# Test canonical uniqueness
def test_canonical_uniqueness():
    """Only one canonical doc per concept allowed"""
    docs = [
        create_doc(title="Agent Infrastructure", canonical=True),
        create_doc(title="Agent Infrastructure Enhancement", canonical=True),
    ]
    errors = validate_canonical_uniqueness(docs)
    assert len(errors) == 1
    assert "Multiple canonical docs" in str(errors[0])

# Test duplicate detection
def test_duplicate_detection():
    """Near-duplicate docs should be detected"""
    inbox_doc = create_doc(
        path="docs/_inbox/test.md",
        content="This is about plugin architecture"
    )
    corpus_doc = create_doc(
        path="docs/rfcs/006-plugin-system-architecture.md",
        content="This document describes plugin architecture"
    )
    errors = detect_near_duplicates([inbox_doc, corpus_doc])
    assert len(errors) >= 1
    assert "Near-duplicate" in str(errors[0])
````text

### Integration Tests

```bash
# Test complete workflow
./tests/integration/test-doc-workflow.sh

# 1. Create draft in inbox
python -c "from task import create_task; create_task('rfc', 'Test RFC')"

# 2. Validate (should pass with warnings)
python scripts/validate-docs.py

# 3. Add complete front-matter
# (edit file manually)

# 4. Move to final location
mv docs/_inbox/test-rfc.md docs/rfcs/999-test-rfc.md

# 5. Validate again (should pass with no warnings)
python scripts/validate-docs.py

# 6. Check registry
cat docs/index/registry.json | jq '.docs[] | select(.doc_id == "RFC-2025-00999")'
```text

### Pre-commit Hook Tests

```bash
# Test pre-commit validation
echo "---
title: Test
---" > docs/test.md

git add docs/test.md
git commit -m "test"
# Should fail: missing required fields

# Fix and retry
echo "---
doc_id: DOC-2025-00001
title: Test
doc_type: guide
status: draft
canonical: false
created: 2025-11-13
tags: [test]
summary: Test doc
---" > docs/test.md

git add docs/test.md
git commit -m "test"
# Should succeed
```text

## Success Criteria

After implementation, the system should:

1. **Enable discovery**:
   - Agents can query `docs/index/registry.json` to find existing docs
   - Registry updated automatically on commit
   - Search by doc_type, status, tags

2. **Prevent duplicates**:
   - Validation warns when similar docs exist
   - Canonical uniqueness enforced
   - SimHash detects content similarity

3. **Enforce quality**:
   - All docs have required front-matter
   - Valid doc_id format
   - Proper status and doc_type values
   - Pre-commit hook catches violations

4. **Support workflows**:
   - `/task` command creates structured drafts
   - Inbox allows low-friction drafting
   - Clear path from draft to publication
   - Superseded docs tracked properly

5. **Maintain organization**:
   - Docs categorized by type (rfcs/, guides/, architecture/, planning/)
   - Root directory clean (no scattered planning docs)
   - Archive for superseded content

## Performance Considerations

1. **Validation speed**:
   - Skip registry regeneration in pre-commit mode
   - Cache parsed YAML front-matter
   - Only validate changed files (future optimization)

2. **Registry size**:
   - Registry is JSON (efficient parsing)
   - Simhash reduces to single integer per doc
   - SHA256 enables fast exact-match checks

3. **Duplicate detection**:
   - SimHash O(n) comparison (fast)
   - Fuzzy matching only on SimHash candidates
   - Optional dependencies (graceful degradation)

## Backward Compatibility

**Existing docs without front-matter**:

- Generate warnings, not errors (initially)
- Migration plan to add front-matter gradually
- Inbox pattern allows existing workflow to continue

**Existing directory structure**:

- Keep all existing paths (`docs/rfcs/`, `docs/fonts/`, `docs/terminals/`)
- Additive changes only (new directories: `guides/`, `architecture/`, `planning/`)
- No breaking changes to existing docs

**Existing workflows**:

- Agents can still create docs manually (not required to use `/task`)
- Validation is helpful, not blocking (warnings allowed)
- Pre-commit hook can be disabled if needed

## Migration Path

### Immediate Changes (Breaking: None)

1. Create new directories (`_inbox/`, `index/`, `guides/`, `architecture/`, `planning/`)
2. Add validation script (doesn't run automatically yet)
3. Add `/task` command (optional to use)
4. Add agent rules (guidance only)

### Gradual Migration (Week 2-3)

1. Add front-matter to existing RFCs (already well-structured)
2. Move root-level planning docs to `docs/planning/`
3. Generate doc_ids for existing docs
4. Add tags and summaries

### Full Enforcement (Week 4+)

1. Enable pre-commit hook (validation required)
2. Treat missing front-matter as errors (not warnings)
3. Require doc_ids for all new docs
4. Enforce canonical uniqueness

## Alternatives Considered

### Alternative 1: No Inbox Pattern

**Approach**: Create docs directly in final location with full front-matter

**Pros**: Simpler structure, fewer steps
**Cons**: High friction for drafting, agents need to know final location upfront

**Decision**: Rejected - inbox pattern enables low-friction iteration

### Alternative 2: Wiki-Style Flat Structure

**Approach**: All docs in single `docs/` directory, no subdirectories

**Pros**: Simple, easy to browse
**Cons**: Doesn't scale, hard to find docs, no categorization

**Decision**: Rejected - subdirectories provide necessary organization

### Alternative 3: Git-Based Validation Only

**Approach**: Use git hooks without registry generation

**Pros**: Simpler, less infrastructure
**Cons**: No discovery mechanism for agents, no duplicate detection

**Decision**: Rejected - registry is critical for agent intelligence

### Alternative 4: Markdown-Only Metadata (No YAML)

**Approach**: Use markdown headers instead of YAML front-matter

**Pros**: More readable, no special parsing needed
**Cons**: Hard to validate, not machine-readable, no standards

**Decision**: Rejected - YAML front-matter is industry standard

### Alternative 5: Database-Backed Registry

**Approach**: Store document metadata in SQLite/PostgreSQL

**Pros**: Powerful queries, relational structure
**Cons**: Complex setup, not git-friendly, requires running service

**Decision**: Rejected - JSON registry is simpler and git-friendly

## Open Questions

1. **Doc ID generation**: Manual or automatic?
   - **Proposal**: Manual initially (agents generate from template), consider auto-increment later

2. **Registry updates**: On every commit or on-demand?
   - **Proposal**: On every commit (via pre-commit hook), but skip in `--pre-commit` mode to avoid infinite loop

3. **Duplicate thresholds**: What SimHash/fuzzy match thresholds?
   - **Proposal**: Hamming distance ≤ 8, title similarity ≥ 80% (tunable via config)

4. **Front-matter migration**: Add to all existing docs immediately?
   - **Proposal**: Gradual migration, start with RFCs, then guides, then others

5. **CI integration**: Run validation in GitHub Actions?
   - **Proposal**: Yes, but as separate PR check (not blocking initially)

6. **Multi-language docs**: Support localization (en/, es/, etc.)?
   - **Proposal**: Not in v1, but schema supports it (add `language` field later)

## Dependencies

### Python Packages

```txt
pyyaml>=6.0.1        # YAML front-matter parsing
simhash>=2.1.2       # Content similarity detection (optional)
rapidfuzz>=3.5.2     # Fuzzy string matching (optional)
```text

Installation:

```bash
pip install -r requirements.txt
```text

### Pre-commit Hook

Requires `pre-commit` to be installed:

```bash
pip install pre-commit
pre-commit install
```text

## References

- [YAML Front Matter](https://jekyllrb.com/docs/front-matter/)
- [SimHash Algorithm](https://en.wikipedia.org/wiki/SimHash)
- [Markdown Standards](https://commonmark.org/)
- [Architecture Decision Records (ADR)](https://adr.github.io/)
- [RFC Process](https://en.wikipedia.org/wiki/Request_for_Comments)
- [Document Management Best Practices](https://www.writethedocs.org/)

## Related RFCs

- [RFC-004: Agent Infrastructure Enhancement](./004-agent-infrastructure-enhancement.md) - Agent capabilities this system supports

## Appendix A: Example Documents

### Example: RFC with Full Front-Matter

```yaml
---
doc_id: 'RFC-2025-00012'
title: 'Documentation Organization Management'
doc_type: 'rfc'
status: 'draft'
canonical: true
created: '2025-11-13'
updated: '2025-11-13'
author: 'Development Team'
tags: ['infrastructure', 'documentation', 'agent-tools', 'automation']
summary: 'Structured documentation management system with validation, registry generation, and inbox workflow for autonomous agents'
supersedes: []
related: ['RFC-2025-00004']
---
# RFC-012: Documentation Organization Management

[Document content...]
```text

### Example: Guide in Inbox (Minimal)

```yaml
---
title: "Setting Up Development Environment"
doc_type: "guide"
status: "draft"
created: "2025-11-13"
---

# Setting Up Development Environment

[Work in progress content...]

TODO:
- Add prerequisites section
- Document IDE setup
- Add troubleshooting
- Complete front-matter before moving to docs/guides/
```text

### Example: Superseded Document

```yaml
---
doc_id: "RFC-2025-00001"
title: "Initial Rendering Architecture (Superseded)"
doc_type: "rfc"
status: "superseded"
canonical: false
created: "2025-01-15"
updated: "2025-03-20"
tags: ["rendering", "architecture", "superseded"]
summary: "Original rendering architecture proposal (superseded by RFC-2025-00008)"
supersedes: []
related: ["RFC-2025-00008"]
---

**Note**: This RFC has been superseded by [RFC-008: Enhanced Rendering Architecture](../rfcs/008-enhanced-rendering-architecture.md).

[Original content preserved for historical reference...]
```text

## Appendix B: Validation Error Examples

### Error: Missing Required Fields

```text
[ERROR] docs/rfcs/test.md: Missing required fields: doc_id, tags, summary
```text

Fix: Add missing fields to front-matter

### Error: Invalid doc_type

```text
[ERROR] docs/guides/test.md: Invalid doc_type 'tutorial'. Must be one of: spec, rfc, adr, plan, finding, guide, glossary, reference
```text

Fix: Change `doc_type: tutorial` to `doc_type: guide`

### Warning: Near-Duplicate Detected

```text
[WARNING] Near-duplicate detected:
  Inbox:  docs/_inbox/plugin-architecture.md
  Corpus: docs/rfcs/006-plugin-system-architecture.md
  Title similarity: 85%, Content similarity: 92%
```text

Action: Review existing doc, consider updating instead of creating new one

### Error: Multiple Canonical Documents

```text
[ERROR] Multiple canonical docs for concept 'agent infrastructure':
  docs/rfcs/004-agent-infrastructure-enhancement.md
  docs/rfcs/012-documentation-organization-management.md
```text

Fix: Set `canonical: false` on one of them
`````
