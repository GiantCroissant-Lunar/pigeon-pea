# Example GitHub Actions workflow for Windows visual testing
# This is a reference example - copy to .github/workflows/ to use

name: Windows Visual Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  windows-visual-tests:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0.x'

      - name: Install FFmpeg
        run: |
          choco install ffmpeg -y
          ffmpeg -version

      - name: Run basic rendering test
        run: |
          cd tests/windows
          .\record-test.ps1 -TestName "ci-basic-test" -Duration 5

      - name: Run particle effect test
        run: |
          cd tests/windows
          .\record-test.ps1 -TestName "ci-particle-test" -Duration 10

      - name: Upload test recordings
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: windows-test-recordings
          path: tests/windows/recordings/

      - name: Upload FFmpeg logs
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: ffmpeg-logs
          path: tests/windows/recordings/*-ffmpeg-log.txt

      - name: Check recording file sizes
        if: success()
        run: |
          cd tests/windows/recordings
          Get-ChildItem *.mp4 | ForEach-Object {
            $sizeMB = [math]::Round($_.Length / 1MB, 2)
            Write-Host "$($_.Name): $sizeMB MB"
          }
