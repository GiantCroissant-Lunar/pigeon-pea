# Agent Infrastructure

This document describes the agent infrastructure for the pigeon-pea project.

## Overview

The `.agent` directory contains all agent-related configurations, rules, commands, workflows, and adapters. This structured approach ensures consistent agent behavior and maintainable automation.

## Directory Structure

```
.agent/
├── rules/          # Agent behavior rules and constraints
├── commands/       # Custom executable commands
├── workflows/      # Multi-step process definitions
└── adapters/       # External system integrations
```

## Components

### Rules

Rules define how agents should behave, what constraints they must follow, and what policies govern their actions.

**Location:** [`.agent/rules/`](.agent/rules/)

**Examples:**

- [`.agent/rules/git-commit-rules.md`](.agent/rules/git-commit-rules.md) - **Git and commit requirements (CRITICAL: commits must pass pre-commit hooks)**
- [`.agent/rules/code-quality.md`](.agent/rules/code-quality.md) - Code quality and standards enforcement

**Documentation:** [`.agent/rules/README.md`](.agent/rules/README.md)

### Commands

Commands are executable operations that agents can invoke to perform specific tasks.

**Location:** [`.agent/commands/`](.agent/commands/)

**Examples:**

- [`.agent/commands/run-tests.yaml`](.agent/commands/run-tests.yaml) - Test execution across languages

**Documentation:** [`.agent/commands/README.md`](.agent/commands/README.md)

### Workflows

Workflows orchestrate multiple steps and decisions into cohesive processes.

**Location:** [`.agent/workflows/`](.agent/workflows/)

**Examples:**

- [`.agent/workflows/feature-development.yaml`](.agent/workflows/feature-development.yaml) - Feature development lifecycle

**Documentation:** [`.agent/workflows/README.md`](.agent/workflows/README.md)

### Adapters

Adapters provide interfaces between agents and external systems, APIs, or services.

**Location:** [`.agent/adapters/`](.agent/adapters/)

**Examples:**

- [`.agent/adapters/github-adapter.yaml`](.agent/adapters/github-adapter.yaml) - GitHub API integration

**Documentation:** [`.agent/adapters/README.md`](.agent/adapters/README.md)

## Adding New Components

### Adding a Rule

1. Create a new file in [`.agent/rules/`](.agent/rules/)
2. Use `.md` for documentation-style rules or `.yaml` for structured definitions
3. Follow the examples in the directory for consistency

### Adding a Command

1. Create a new file in [`.agent/commands/`](.agent/commands/)
2. Use appropriate format (`.yaml`, `.sh`, `.ps1`, `.py`)
3. Ensure command is documented with clear description and parameters
4. Include conditions and error handling as needed

### Adding a Workflow

1. Create a workflow definition in [`.agent/workflows/`](.agent/workflows/)
2. Define clear stages and steps
3. Use structured step format with type (manual/command) and description
4. Include conditions for conditional steps

### Adding an Adapter

1. Create adapter configuration in [`.agent/adapters/`](.agent/adapters/)
2. Define capabilities and API endpoints
3. Structure parameters as objects with name and required fields
4. Include authentication and retry policies

## Integration

### With Pre-commit Hooks

Agent commands can leverage the existing pre-commit infrastructure defined in [`.pre-commit-config.yaml`](.pre-commit-config.yaml).

### With CI/CD

Workflows can be integrated with GitHub Actions or other CI/CD systems to automate development processes.

### With Development Tools

Adapters enable agents to interact with:

- GitHub (issues, PRs, commits)
- Build systems (.NET, npm, Python)
- Testing frameworks
- Code quality tools

## Best Practices

1. **Keep it organized:** Use the appropriate subdirectory for each component type
2. **Document everything:** Include clear descriptions and examples
3. **Use version control:** Track changes to agent configurations
4. **Test before committing:** Validate configurations work as expected
5. **Reference by relative path:** Always use relative paths when referencing files
6. **Follow naming conventions:** Use descriptive, kebab-case names

## Related Documentation

- [CLAUDE.md](CLAUDE.md) - Claude-specific agent configuration
- [README.md](README.md) - Project overview and setup
- [`.pre-commit-config.yaml`](.pre-commit-config.yaml) - Pre-commit hooks configuration

## Agent Infrastructure Registry

<!-- Auto-generated by scripts/generate_registry.py -->
<!-- Do not edit this section manually -->

### Agents

| Name             | Description                                                        | Version | Skills                    |
| ---------------- | ------------------------------------------------------------------ | ------- | ------------------------- |
| CodeReviewAgent  | Reviews code quality, formatting, and enforces coding standards    | 0.1.0   | code-format, code-analyze |
| DotNetBuildAgent | Handles .NET build, restore, compile, and packaging tasks          | 0.1.0   | dotnet-build              |
| Orchestrator     | Top-level router that delegates to sub-agents based on task intent | 0.1.0   | None                      |
| TestingAgent     | Executes tests, generates coverage, runs benchmarks                | 0.1.0   | dotnet-test               |

### Skills

| Name         | Kind | Description                                                                                                                                                           | Version |
| ------------ | ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- |
| code-analyze | cli  | Run static analysis, security scans, and dependency checks on .NET code. Use when task involves code quality, security audits, or vulnerability detection.            | 0.1.0   |
| code-format  | cli  | Format code using dotnet format, prettier, and other formatting tools. Use when task involves code style fixes, formatting consistency, or preparing code for commit. | 0.1.0   |
| dotnet-build | cli  | Build .NET solution/projects using dotnet CLI. Use when task involves compiling, restoring dependencies, or building artifacts.                                       | 0.2.0   |
| dotnet-test  | cli  | Run .NET tests using dotnet CLI. Use when task involves executing unit tests, generating code coverage reports, or running benchmarks.                                | 0.1.0   |
